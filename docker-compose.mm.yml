services:
  kalshi_mm_engine:
    image: python:3.11-slim
    container_name: kalshi_mm_engine
    restart: unless-stopped
    working_dir: /app

    env_file:
      - .env

    environment:
      PYTHONPATH: /app/src

    volumes:
      - ./:/app:rw
      - /home/ubuntu/.kalshi/prod_keys.pem:/run/secrets/prod_keys.pem:ro

    depends_on:
      - clickhouse

    command: ["/bin/sh","-lc","pip install -r requirements.txt && python -m kalshifolder.mm.main"]

    healthcheck:
      test: ["CMD-SHELL", "python -c \"import os; import sys; sys.exit(0)\""]
      interval: 30s
      timeout: 10s
      retries: 3
